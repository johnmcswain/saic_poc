<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PAIS v1.5.3 Token Flow Animation ‚Äî Consolidated Family Learning Cloud</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes glow {
      0%, 100% { filter: drop-shadow(0 0 3px currentColor); }
      50% { filter: drop-shadow(0 0 8px currentColor); }
    }
    .node-active { animation: glow 2.5s ease-in-out infinite; }
    .particle { position: absolute; border-radius: 50%; pointer-events: none; }
  </style>
</head>
<body class="bg-gray-900 min-h-screen p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-2xl font-bold text-white text-center mb-1">PAIS Framework v1.5.3 ‚Äî Token Flow Visualization</h1>
    <p class="text-gray-400 text-center text-sm mb-4">Consolidated Standalone | 20/20 Functional Requirements | Mac Studio (Text) + RTX 4090 (Visual)</p>
    
    <!-- Scenario Selection -->
    <div class="flex flex-wrap gap-2 justify-center mb-4">
      <div class="text-xs text-gray-500 w-full text-center mb-1">TEXT INFERENCE (Mac Studio)</div>
      <button id="btn-small" onclick="selectScenario('small')" class="scenario-btn px-3 py-1.5 bg-green-700 hover:bg-green-600 text-white rounded text-xs font-medium transition-all" data-base="bg-green-700">7B Fast</button>
      <button id="btn-socratic" onclick="selectScenario('socratic')" class="scenario-btn px-3 py-1.5 bg-green-700 hover:bg-green-600 text-white rounded text-xs font-medium transition-all" data-base="bg-green-700">üìñ Socratic Math</button>
      <button id="btn-large" onclick="selectScenario('large')" class="scenario-btn px-3 py-1.5 bg-green-700 hover:bg-green-600 text-white rounded text-xs font-medium transition-all" data-base="bg-green-700">236B Deep</button>
      <button id="btn-batch" onclick="selectScenario('batch')" class="scenario-btn px-3 py-1.5 bg-green-700 hover:bg-green-600 text-white rounded text-xs font-medium transition-all" data-base="bg-green-700">üåô Nightly Batch</button>
      
      <div class="text-xs text-gray-500 w-full text-center mb-1 mt-2">VISUAL AI (RTX 4090)</div>
      <button id="btn-image" onclick="selectScenario('image')" class="scenario-btn px-3 py-1.5 bg-lime-600 hover:bg-lime-500 text-white rounded text-xs font-medium transition-all" data-base="bg-lime-600">üñºÔ∏è Image Gen</button>
      <button id="btn-video" onclick="selectScenario('video')" class="scenario-btn px-3 py-1.5 bg-lime-600 hover:bg-lime-500 text-white rounded text-xs font-medium transition-all" data-base="bg-lime-600">üé¨ Video Gen</button>
      <button id="btn-audio" onclick="selectScenario('audio')" class="scenario-btn px-3 py-1.5 bg-lime-600 hover:bg-lime-500 text-white rounded text-xs font-medium transition-all" data-base="bg-lime-600">üéôÔ∏è Voice TTS</button>
      <button id="btn-transcode" onclick="selectScenario('transcode')" class="scenario-btn px-3 py-1.5 bg-lime-600 hover:bg-lime-500 text-white rounded text-xs font-medium transition-all" data-base="bg-lime-600">üìπ NVENC</button>
      
      <div class="text-xs text-gray-500 w-full text-center mb-1 mt-2">WORKFLOWS &amp; OTHER</div>
      <button id="btn-assistant" onclick="selectScenario('assistant')" class="scenario-btn px-3 py-1.5 bg-orange-600 hover:bg-orange-500 text-white rounded text-xs font-medium transition-all" data-base="bg-orange-600">ü§ñ OpenClaw</button>
      <button id="btn-portfolio" onclick="selectScenario('portfolio')" class="scenario-btn px-3 py-1.5 bg-pink-600 hover:bg-pink-500 text-white rounded text-xs font-medium transition-all" data-base="bg-pink-600">üìù Essay+Art</button>
      <button id="btn-overflow" onclick="selectScenario('overflow')" class="scenario-btn px-3 py-1.5 bg-purple-700 hover:bg-purple-600 text-white rounded text-xs font-medium transition-all" data-base="bg-purple-700">‚òÅÔ∏è Cloud 405B+</button>
    </div>

    <!-- SVG Diagram -->
    <div class="relative bg-gray-800 rounded-lg p-2 overflow-hidden">
      <svg id="architecture" viewBox="0 0 900 720" class="w-full h-auto">
        <defs>
          <filter id="glow"><feGaussianBlur stdDeviation="2" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          <filter id="particleGlow"><feGaussianBlur stdDeviation="1.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        
        <!-- Background Regions -->
        <rect x="30" y="80" width="840" height="55" rx="8" fill="#1a365d" opacity="0.3"/>
        <text x="450" y="112" text-anchor="middle" fill="#63b3ed" font-size="11" font-weight="bold">üîí TAILSCALE MESH ‚Äî Zero-Trust VPN | pais.tailnet.ts.net</text>

        <!-- Local Inference Region -->
        <rect x="30" y="195" width="840" height="180" rx="8" fill="#1c4532" opacity="0.2"/>
        <text x="50" y="215" fill="#68d391" font-size="10" font-weight="bold">DUAL-SPECIALIZATION INFERENCE (95%+ Local)</text>

        <!-- Cloud Overflow Region -->
        <rect x="30" y="395" width="840" height="170" rx="8" fill="#44337a" opacity="0.2"/>
        <text x="50" y="415" fill="#b794f4" font-size="10" font-weight="bold">CLOUD OVERFLOW (5%) ‚Äî Policy Controlled | Adult-Only Default</text>

        <!-- Static guide lines -->
        <g opacity="0.15" fill="none" stroke="#4a5568" stroke-width="1">
          <line x1="450" y1="55" x2="450" y2="145"/>
          <path d="M 380 175 Q 200 200 120 235"/>
          <path d="M 450 175 Q 450 200 450 235"/>
          <path d="M 520 175 Q 700 200 780 235"/>
          <line x1="540" y1="160" x2="630" y2="160" stroke-dasharray="4,2"/>
          <path d="M 720 185 Q 720 300 450 430" stroke-dasharray="4,2"/>
          <path d="M 210 310 Q 500 330 755 345" stroke="#ec4899" stroke-dasharray="3,2"/>
          <path d="M 530 310 Q 650 330 755 345" stroke="#ec4899" stroke-dasharray="3,2"/>
        </g>

        <!-- Client -->
        <g id="node-client" class="node" data-x="450" data-y="40">
          <rect x="380" y="20" width="140" height="40" rx="8" fill="#2d3748" stroke="#4a5568" stroke-width="1.5"/>
          <text x="450" y="45" text-anchor="middle" fill="white" font-size="12" font-weight="bold">üë§ Client Request</text>
        </g>

        <!-- Intelligent Router -->
        <g id="node-router" class="node" data-x="450" data-y="160">
          <rect x="340" y="140" width="220" height="45" rx="8" fill="#2d3748" stroke="#2d6a4f" stroke-width="2"/>
          <text x="450" y="158" text-anchor="middle" fill="white" font-size="11" font-weight="bold">üéØ Intelligent Router</text>
          <text x="450" y="175" text-anchor="middle" fill="#68d391" font-size="9">Text‚ÜíMac Studio | Visual‚ÜíRTX 4090</text>
        </g>

        <!-- PII Filter -->
        <g id="node-piiFilter" class="node" data-x="720" data-y="160">
          <rect x="630" y="140" width="180" height="45" rx="8" fill="#2d3748" stroke="#ed1c24" stroke-width="2"/>
          <text x="720" y="158" text-anchor="middle" fill="white" font-size="11" font-weight="bold">üõ°Ô∏è Nemotron PII Filter</text>
          <text x="720" y="175" text-anchor="middle" fill="#fc8181" font-size="9">Cloud Requests Only</text>
        </g>

        <!-- Mac Studio - TEXT LLMs -->
        <g id="node-macStudio" class="node" data-x="120" data-y="270">
          <rect x="30" y="235" width="180" height="75" rx="8" fill="#2d3748" stroke="#1565c0" stroke-width="2"/>
          <text x="120" y="258" text-anchor="middle" fill="white" font-size="11" font-weight="bold">üçé Mac Studio M3 Ultra</text>
          <text x="120" y="275" text-anchor="middle" fill="#90cdf4" font-size="9">TEXT LLMs | 256GB | 4TB</text>
          <text x="120" y="290" text-anchor="middle" fill="#63b3ed" font-size="8">70B: 6-7 tok/s | 236B: 2-3 tok/s</text>
          <text x="120" y="303" text-anchor="middle" fill="#a0aec0" font-size="8">Ollama :11434</text>
        </g>

        <!-- RTX 4090 - VISUAL AI -->
        <g id="node-rtx4090" class="node" data-x="450" data-y="270">
          <rect x="280" y="235" width="340" height="75" rx="8" fill="#2d3748" stroke="#76b900" stroke-width="3"/>
          <text x="450" y="258" text-anchor="middle" fill="white" font-size="11" font-weight="bold">üé® RTX 4090 ‚Äî VISUAL AI HUB</text>
          <text x="450" y="275" text-anchor="middle" fill="#9ae6b4" font-size="9">24GB VRAM | 16K CUDA | 64GB DDR5 | ~600W</text>
          <text x="350" y="292" text-anchor="middle" fill="#68d391" font-size="8">ComfyUI :8188</text>
          <text x="420" y="292" text-anchor="middle" fill="#68d391" font-size="8">Video :7860</text>
          <text x="490" y="292" text-anchor="middle" fill="#68d391" font-size="8">TTS :5002</text>
          <text x="560" y="292" text-anchor="middle" fill="#68d391" font-size="8">NVENC :9000</text>
          <text x="450" y="305" text-anchor="middle" fill="#a0aec0" font-size="8">Image 8-12s | Video 60-90s | Voice Real-time</text>
        </g>

        <!-- OpenClaw on RPi5 #1 -->
        <g id="node-openClaw" class="node" data-x="780" data-y="270">
          <rect x="690" y="235" width="170" height="75" rx="8" fill="#2d3748" stroke="#ff6f00" stroke-width="2"/>
          <text x="775" y="258" text-anchor="middle" fill="white" font-size="11" font-weight="bold">ü§ñ OpenClaw RPi5 #1</text>
          <text x="775" y="275" text-anchor="middle" fill="#fbd38d" font-size="9">16GB | Isolated 24/7</text>
          <text x="775" y="290" text-anchor="middle" fill="#f6ad55" font-size="8">qwen2.5:7b | Email/Cal</text>
          <text x="775" y="303" text-anchor="middle" fill="#a0aec0" font-size="8">:3000</text>
        </g>

        <!-- AI Max+ (Knowledge) -->
        <g id="node-knowledge" class="node" data-x="120" data-y="370">
          <rect x="30" y="340" width="180" height="55" rx="8" fill="#2d3748" stroke="#9c27b0" stroke-width="1.5"/>
          <text x="120" y="362" text-anchor="middle" fill="white" font-size="11" font-weight="bold">üß† Knowledge Layer</text>
          <text x="120" y="378" text-anchor="middle" fill="#d6bcfa" font-size="9">AI Max+ 128GB | Qdrant :6333</text>
          <text x="120" y="390" text-anchor="middle" fill="#a0aec0" font-size="8">user_progress | obsidian_vault</text>
        </g>

        <!-- NAS Storage Layer -->
        <g id="node-nas" class="node" data-x="820" data-y="370">
          <rect x="710" y="325" width="170" height="80" rx="8" fill="#2d3748" stroke="#ec4899" stroke-width="1.5"/>
          <text x="795" y="345" text-anchor="middle" fill="white" font-size="10" font-weight="bold">üíæ Synology NAS</text>
          <text x="795" y="360" text-anchor="middle" fill="#f9a8d4" font-size="8">DS423 | 24TB SHR</text>
          <text x="795" y="375" text-anchor="middle" fill="#f687b3" font-size="7">/models /qdrant /backups</text>
          <text x="795" y="388" text-anchor="middle" fill="#f687b3" font-size="7">/generated /portfolios</text>
          <text x="795" y="400" text-anchor="middle" fill="#a0aec0" font-size="7">‚Üí Backblaze B2</text>
        </g>

        <!-- Cloud Gateway -->
        <g id="node-cloudGateway" class="node" data-x="450" data-y="445">
          <rect x="350" y="420" width="200" height="50" rx="8" fill="#2d3748" stroke="#6a1b9a" stroke-width="2"/>
          <text x="450" y="442" text-anchor="middle" fill="white" font-size="11" font-weight="bold">‚òÅÔ∏è Cloud Gateway (Proxy)</text>
          <text x="450" y="458" text-anchor="middle" fill="#d6bcfa" font-size="9">Traefik | Rate Limits | Logging</text>
        </g>

        <!-- Cloud Services Row -->
        <g id="node-brev" class="node" data-x="150" data-y="530">
          <rect x="50" y="505" width="200" height="50" rx="8" fill="#553c9a" stroke="#6a1b9a" stroke-width="1.5"/>
          <text x="150" y="527" text-anchor="middle" fill="white" font-size="11" font-weight="bold">üü¢ NVIDIA Brev</text>
          <text x="150" y="543" text-anchor="middle" fill="#d6bcfa" font-size="9">405B+ Models | GPU Cloud</text>
        </g>
        <g id="node-gemini" class="node" data-x="450" data-y="530">
          <rect x="350" y="505" width="200" height="50" rx="8" fill="#553c9a" stroke="#6a1b9a" stroke-width="1.5"/>
          <text x="450" y="527" text-anchor="middle" fill="white" font-size="11" font-weight="bold">üîµ Gemini API</text>
          <text x="450" y="543" text-anchor="middle" fill="#d6bcfa" font-size="9">Fast, Cost-Effective</text>
        </g>
        <g id="node-anthropic" class="node" data-x="750" data-y="530">
          <rect x="650" y="505" width="200" height="50" rx="8" fill="#553c9a" stroke="#6a1b9a" stroke-width="1.5"/>
          <text x="750" y="527" text-anchor="middle" fill="white" font-size="11" font-weight="bold">üü† Claude API</text>
          <text x="750" y="543" text-anchor="middle" fill="#d6bcfa" font-size="9">Complex Reasoning</text>
        </g>

        <!-- Response -->
        <g id="node-response" class="node" data-x="450" data-y="620">
          <rect x="350" y="595" width="200" height="45" rx="8" fill="#2d3748" stroke="#2d6a4f" stroke-width="2"/>
          <text x="450" y="615" text-anchor="middle" fill="white" font-size="12" font-weight="bold">‚úÖ Response</text>
          <text x="450" y="630" text-anchor="middle" fill="#68d391" font-size="9">To Client</text>
        </g>

        <!-- Legend -->
        <g transform="translate(30, 665)">
          <text fill="#a0aec0" font-size="10" font-weight="bold">LEGEND:</text>
          <circle cx="80" cy="-3" r="3" fill="#48bb78"/>
          <text x="88" y="1" fill="#a0aec0" font-size="9">Text</text>
          <circle cx="125" cy="-3" r="3" fill="#9ae6b4"/>
          <text x="133" y="1" fill="#a0aec0" font-size="9">Visual</text>
          <circle cx="175" cy="-3" r="3" fill="#f6ad55"/>
          <text x="183" y="1" fill="#a0aec0" font-size="9">Assistant</text>
          <circle cx="235" cy="-3" r="3" fill="#b794f4"/>
          <text x="243" y="1" fill="#a0aec0" font-size="9">Cloud</text>
          <circle cx="285" cy="-3" r="3" fill="#f687b3"/>
          <text x="293" y="1" fill="#a0aec0" font-size="9">Storage</text>
          <line x1="345" y1="-3" x2="375" y2="-3" stroke="#48bb78" stroke-width="3"/>
          <text x="383" y="1" fill="#a0aec0" font-size="9">Local</text>
          <line x1="420" y1="-3" x2="450" y2="-3" stroke="#b794f4" stroke-width="3" stroke-dasharray="6,3"/>
          <text x="458" y="1" fill="#a0aec0" font-size="9">Cloud</text>
        </g>

        <!-- Animated paths container -->
        <g id="paths"></g>
        <!-- Particles container -->
        <g id="particles"></g>
      </svg>

      <!-- Info Panel -->
      <div id="infoPanel" class="absolute top-2 right-2 bg-gray-900/90 rounded-lg p-3 text-white text-sm max-w-xs">
        <div id="scenarioName" class="font-bold text-green-400 mb-1">Select a scenario</div>
        <div id="scenarioDesc" class="text-gray-300 text-xs mb-2">Click a button to visualize token flow</div>
        <div id="metrics" class="text-xs space-y-1 hidden">
          <div>Speed: <span id="metricSpeed" class="text-green-400">-</span></div>
          <div>Latency: <span id="metricLatency" class="text-yellow-400">-</span></div>
          <div>Destination: <span id="metricDest" class="text-blue-400">-</span></div>
        </div>
      </div>
    </div>

    <!-- Architecture Summary -->
    <div class="mt-4 grid grid-cols-2 md:grid-cols-6 gap-2 text-xs">
      <div class="bg-blue-900/50 rounded-lg p-2 border border-blue-700/30">
        <div class="text-blue-300 font-bold">Mac Studio</div>
        <div class="text-gray-400">256GB | Text LLMs</div>
      </div>
      <div class="bg-lime-900/50 rounded-lg p-2 border border-lime-700/30">
        <div class="text-lime-300 font-bold">RTX 4090</div>
        <div class="text-gray-400">24GB VRAM | Visual</div>
      </div>
      <div class="bg-purple-900/50 rounded-lg p-2 border border-purple-700/30">
        <div class="text-purple-300 font-bold">AI Max+ 395</div>
        <div class="text-gray-400">128GB | Knowledge</div>
      </div>
      <div class="bg-orange-900/50 rounded-lg p-2 border border-orange-700/30">
        <div class="text-orange-300 font-bold">RPi5 √ó3</div>
        <div class="text-gray-400">OpenClaw + IoT</div>
      </div>
      <div class="bg-pink-900/50 rounded-lg p-2 border border-pink-700/30">
        <div class="text-pink-300 font-bold">Synology NAS</div>
        <div class="text-gray-400">24TB | 3-2-1 Backup</div>
      </div>
      <div class="bg-gray-700/50 rounded-lg p-2 border border-gray-600/30">
        <div class="text-gray-300 font-bold">Total Power</div>
        <div class="text-gray-400">~1,045W Full Stack</div>
      </div>
    </div>
  </div>

  <script>
    const nodeColors = {
      client: '#4a5568', router: '#2d6a4f', piiFilter: '#ed1c24',
      macStudio: '#1565c0', rtx4090: '#76b900', openClaw: '#ff6f00',
      knowledge: '#9c27b0', nas: '#ec4899', cloudGateway: '#6a1b9a',
      brev: '#ce93d8', gemini: '#ce93d8', anthropic: '#ce93d8', response: '#2d6a4f'
    };

    const flowPaths = {
      'client-router': { type: 'line', points: [[450, 55], [450, 140]] },
      'router-macStudio': { type: 'curve', points: [[380, 175], [200, 200], [120, 235]] },
      'router-rtx4090': { type: 'line', points: [[450, 185], [450, 235]] },
      'router-openClaw': { type: 'curve', points: [[520, 175], [700, 200], [775, 235]] },
      'router-piiFilter': { type: 'line', points: [[560, 160], [630, 160]] },
      'macStudio-knowledge': { type: 'line', points: [[120, 310], [120, 340]] },
      'rtx4090-knowledge': { type: 'curve', points: [[380, 310], [200, 330], [180, 350]] },
      'knowledge-macStudio': { type: 'curve', points: [[150, 340], [170, 320], [170, 310]] },
      'macStudio-nas': { type: 'curve', points: [[210, 280], [500, 320], [710, 365]] },
      'rtx4090-nas': { type: 'curve', points: [[620, 280], [680, 320], [710, 365]] },
      'openClaw-nas': { type: 'line', points: [[775, 310], [795, 325]] },
      'knowledge-nas': { type: 'curve', points: [[210, 370], [500, 385], [710, 375]] },
      'piiFilter-cloudGateway': { type: 'curve', points: [[720, 185], [720, 300], [450, 420]] },
      'cloudGateway-brev': { type: 'curve', points: [[380, 470], [260, 490], [150, 505]] },
      'cloudGateway-gemini': { type: 'line', points: [[450, 470], [450, 505]] },
      'cloudGateway-anthropic': { type: 'curve', points: [[520, 470], [640, 490], [750, 505]] },
      'macStudio-response': { type: 'curve', points: [[120, 310], [200, 470], [450, 595]] },
      'rtx4090-response': { type: 'curve', points: [[450, 310], [450, 450], [450, 595]] },
      'openClaw-response': { type: 'curve', points: [[775, 310], [620, 470], [450, 595]] },
      'brev-response': { type: 'curve', points: [[150, 555], [300, 580], [450, 595]] },
      'gemini-response': { type: 'line', points: [[450, 555], [450, 595]] },
      'anthropic-response': { type: 'curve', points: [[750, 555], [600, 580], [450, 595]] },
      'macStudio-rtx4090': { type: 'curve', points: [[210, 270], [300, 270], [280, 270]] },
    };

    const scenarios = {
      small: {
        name: '7B Model ‚Äî Fast Text',
        description: 'Small text models route to Mac Studio for fast inference',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-macStudio', delay: 600 },
          { path: 'macStudio-knowledge', delay: 500 },
          { path: 'knowledge-macStudio', delay: 500 },
          { path: 'macStudio-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'macStudio', 'knowledge', 'response'],
        metrics: { speed: '50+ tok/s', latency: '15ms', dest: 'Mac Studio (Text LLM)' },
        isCloud: false,
        particleColor: '#48bb78'
      },
      socratic: {
        name: 'üìñ Workflow 1: Socratic Math Session',
        description: 'Child opens AnythingLLM ‚Üí Math Tutor mode ‚Üí LangFlow Socratic ‚Üí Mac Studio ‚Üí mastery from Qdrant ‚Üí updates user_progress',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-macStudio', delay: 600 },
          { path: 'macStudio-nas', delay: 500 },
          { path: 'macStudio-knowledge', delay: 500 },
          { path: 'knowledge-macStudio', delay: 500 },
          { path: 'macStudio-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'macStudio', 'nas', 'knowledge', 'response'],
        metrics: { speed: '6-7 tok/s', latency: '45ms', dest: 'Mac Studio (Socratic Mode)' },
        isCloud: false,
        particleColor: '#48bb78'
      },
      large: {
        name: '236B Model ‚Äî Deep Reasoning',
        description: 'DeepSeek v3 236B for complex analysis, PBL coaching, Explain-3-Ways',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-macStudio', delay: 600 },
          { path: 'macStudio-nas', delay: 600 },
          { path: 'macStudio-knowledge', delay: 500 },
          { path: 'knowledge-macStudio', delay: 500 },
          { path: 'macStudio-response', delay: 700 }
        ],
        nodes: ['client', 'router', 'macStudio', 'nas', 'knowledge', 'response'],
        metrics: { speed: '2-3 tok/s', latency: '200ms', dest: 'Mac Studio (Deep Reasoning)' },
        isCloud: false,
        particleColor: '#48bb78'
      },
      batch: {
        name: 'üåô Workflow 3: Nightly Learning Automation',
        description: '2 AM n8n trigger ‚Üí Summarize journals ‚Üí Generate problems ‚Üí TTS diagrams ‚Üí Email report to parents',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-macStudio', delay: 600 },
          { path: 'macStudio-knowledge', delay: 500 },
          { path: 'router-rtx4090', delay: 600 },
          { path: 'rtx4090-nas', delay: 500 },
          { path: 'macStudio-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'macStudio', 'knowledge', 'rtx4090', 'nas', 'response'],
        metrics: { speed: 'Batch', latency: 'Scheduled', dest: 'Mac Studio + RTX 4090 (n8n)' },
        isCloud: false,
        particleColor: '#48bb78'
      },
      image: {
        name: 'üñºÔ∏è Image Generation ‚Äî ComfyUI',
        description: 'SDXL/LoRA for lesson diagrams, portfolio cover art, style-consistent sets',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-rtx4090', delay: 600 },
          { path: 'rtx4090-nas', delay: 500 },
          { path: 'rtx4090-response', delay: 800 }
        ],
        nodes: ['client', 'router', 'rtx4090', 'nas', 'response'],
        metrics: { speed: '8-12 sec/img', latency: '100ms', dest: 'RTX 4090 ComfyUI :8188' },
        isCloud: false,
        particleColor: '#9ae6b4'
      },
      video: {
        name: 'üé¨ Video Generation ‚Äî Stable Video',
        description: 'Animated explainers for science/math concepts, project documentation',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-rtx4090', delay: 600 },
          { path: 'rtx4090-nas', delay: 600 },
          { path: 'rtx4090-response', delay: 900 }
        ],
        nodes: ['client', 'router', 'rtx4090', 'nas', 'response'],
        metrics: { speed: '60-90 sec/vid', latency: '150ms', dest: 'RTX 4090 Stable Video :7860' },
        isCloud: false,
        particleColor: '#9ae6b4'
      },
      audio: {
        name: 'üéôÔ∏è Voice Synthesis ‚Äî Coqui TTS',
        description: 'Audiobook narration for lessons, stories, blog posts, multi-language',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-rtx4090', delay: 600 },
          { path: 'rtx4090-nas', delay: 400 },
          { path: 'rtx4090-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'rtx4090', 'nas', 'response'],
        metrics: { speed: 'Real-time', latency: '50ms', dest: 'RTX 4090 Coqui TTS :5002' },
        isCloud: false,
        particleColor: '#9ae6b4'
      },
      transcode: {
        name: 'üìπ Video Transcode ‚Äî NVENC',
        description: 'H.265 encoding for family media library via FFmpeg NVENC',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-rtx4090', delay: 600 },
          { path: 'rtx4090-nas', delay: 500 },
          { path: 'rtx4090-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'rtx4090', 'nas', 'response'],
        metrics: { speed: 'Real-time+', latency: '30ms', dest: 'RTX 4090 FFmpeg NVENC :9000' },
        isCloud: false,
        particleColor: '#9ae6b4'
      },
      assistant: {
        name: 'ü§ñ OpenClaw ‚Äî Personal Assistant',
        description: 'Isolated RPi5 #1 with email, calendar, system monitoring (24/7)',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-openClaw', delay: 600 },
          { path: 'openClaw-nas', delay: 400 },
          { path: 'openClaw-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'openClaw', 'nas', 'response'],
        metrics: { speed: '15 tok/s', latency: '30ms', dest: 'OpenClaw RPi5 #1 (Isolated)' },
        isCloud: false,
        particleColor: '#f6ad55'
      },
      portfolio: {
        name: 'üìù Workflow 2: Essay + Cover Art + Portfolio',
        description: 'Child writes essay ‚Üí Mac Studio editing ‚Üí Git save ‚Üí ComfyUI cover art ‚Üí Jekyll build on M7 #1',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-macStudio', delay: 600 },
          { path: 'macStudio-knowledge', delay: 400 },
          { path: 'macStudio-nas', delay: 500 },
          { path: 'router-rtx4090', delay: 600 },
          { path: 'rtx4090-nas', delay: 500 },
          { path: 'rtx4090-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'macStudio', 'knowledge', 'rtx4090', 'nas', 'response'],
        metrics: { speed: 'Multi-step', latency: '~20s total', dest: 'Mac Studio + RTX 4090 ‚Üí M7 #1' },
        isCloud: false,
        particleColor: '#f687b3'
      },
      overflow: {
        name: '‚òÅÔ∏è 405B+ Model ‚Äî Cloud Overflow',
        description: 'Exceeds local capacity ‚Üí PII filter ‚Üí Cloud Gateway ‚Üí NVIDIA Brev (Adult-only)',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-piiFilter', delay: 600 },
          { path: 'piiFilter-cloudGateway', delay: 800 },
          { path: 'cloudGateway-brev', delay: 600 },
          { path: 'brev-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'piiFilter', 'cloudGateway', 'brev', 'response'],
        metrics: { speed: '40 tok/s', latency: '300ms', dest: 'NVIDIA Brev (Cloud)' },
        isCloud: true,
        particleColor: '#b794f4'
      }
    };

    let animationId = null;
    let particles = [];
    let currentScenario = null;
    let loopTimeoutId = null;
    let stepTimeouts = [];

    function selectScenario(scenarioKey) {
      if (currentScenario === scenarioKey) {
        stopScenario();
        return;
      }
      
      if (currentScenario !== null) {
        clearAnimation();
      }
      
      document.querySelectorAll('.scenario-btn').forEach(btn => {
        btn.classList.remove('ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-gray-900', 
                             'bg-green-500', 'bg-lime-400', 'bg-orange-400', 'bg-purple-500', 'bg-pink-400');
        const baseClass = btn.dataset.base;
        if (baseClass) btn.classList.add(baseClass);
      });
      
      const activeBtn = document.getElementById(`btn-${scenarioKey}`);
      if (activeBtn) {
        const baseClass = activeBtn.dataset.base;
        if (baseClass) activeBtn.classList.remove(baseClass);
        activeBtn.classList.add('ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-gray-900');
        if (baseClass === 'bg-green-700') activeBtn.classList.add('bg-green-500');
        else if (baseClass === 'bg-lime-600') activeBtn.classList.add('bg-lime-400');
        else if (baseClass === 'bg-orange-600') activeBtn.classList.add('bg-orange-400');
        else if (baseClass === 'bg-purple-700') activeBtn.classList.add('bg-purple-500');
        else if (baseClass === 'bg-pink-600') activeBtn.classList.add('bg-pink-400');
      }
      
      currentScenario = scenarioKey;
      runScenario(scenarioKey);
    }

    function stopScenario() {
      clearAnimation();
      currentScenario = null;
      
      document.querySelectorAll('.scenario-btn').forEach(btn => {
        btn.classList.remove('ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-gray-900',
                             'bg-green-500', 'bg-lime-400', 'bg-orange-400', 'bg-purple-500', 'bg-pink-400');
        const baseClass = btn.dataset.base;
        if (baseClass) btn.classList.add(baseClass);
      });
      
      document.getElementById('scenarioName').textContent = 'Select a scenario';
      document.getElementById('scenarioDesc').textContent = 'Click a button to visualize token flow';
      document.getElementById('metrics').classList.add('hidden');
    }

    function getPathString(pathDef) {
      const { type, points } = pathDef;
      if (type === 'line') {
        return `M ${points[0][0]} ${points[0][1]} L ${points[1][0]} ${points[1][1]}`;
      } else {
        return `M ${points[0][0]} ${points[0][1]} Q ${points[1][0]} ${points[1][1]} ${points[2][0]} ${points[2][1]}`;
      }
    }

    function getPointOnPath(pathElement, progress) {
      const length = pathElement.getTotalLength();
      const point = pathElement.getPointAtLength(length * progress);
      return { x: point.x, y: point.y };
    }

    function easeInOutCubic(t) {
      return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
    }

    function clearAnimation() {
      if (animationId) cancelAnimationFrame(animationId);
      if (loopTimeoutId) clearTimeout(loopTimeoutId);
      stepTimeouts.forEach(t => clearTimeout(t));
      animationId = null;
      loopTimeoutId = null;
      stepTimeouts = [];
      particles = [];
      document.getElementById('paths').innerHTML = '';
      document.getElementById('particles').innerHTML = '';
      document.querySelectorAll('.node-active').forEach(el => el.classList.remove('node-active'));
    }

    function runScenario(scenarioKey) {
      if (currentScenario !== scenarioKey) return;
      
      clearAnimation();
      const scenario = scenarios[scenarioKey];
      
      document.getElementById('scenarioName').textContent = scenario.name;
      document.getElementById('scenarioDesc').textContent = scenario.description;
      document.getElementById('metrics').classList.remove('hidden');
      document.getElementById('metricSpeed').textContent = scenario.metrics.speed;
      document.getElementById('metricLatency').textContent = scenario.metrics.latency;
      document.getElementById('metricDest').textContent = scenario.metrics.dest;

      scenario.nodes.forEach(nodeId => {
        const node = document.getElementById(`node-${nodeId}`);
        if (node) node.classList.add('node-active');
      });

      const pathsContainer = document.getElementById('paths');
      const particlesContainer = document.getElementById('particles');
      const particleColor = scenario.particleColor || (scenario.isCloud ? '#b794f4' : '#48bb78');
      
      let stepIndex = 0;

      function processStep() {
        if (currentScenario !== scenarioKey) return;
        
        if (stepIndex >= scenario.steps.length) {
          loopTimeoutId = setTimeout(() => {
            if (currentScenario === scenarioKey) {
              runScenario(scenarioKey);
            }
          }, 2000);
          return;
        }

        const step = scenario.steps[stepIndex];
        const pathDef = flowPaths[step.path];
        if (!pathDef) { stepIndex++; processStep(); return; }

        const pathString = getPathString(pathDef);
        const pathElement = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        pathElement.setAttribute('d', pathString);
        pathElement.setAttribute('fill', 'none');
        pathElement.setAttribute('stroke', particleColor);
        pathElement.setAttribute('stroke-width', scenario.isCloud ? '2' : '3');
        pathElement.setAttribute('opacity', '0.6');
        if (scenario.isCloud) pathElement.setAttribute('stroke-dasharray', '8,4');
        pathsContainer.appendChild(pathElement);

        const pathLength = pathElement.getTotalLength();
        pathElement.style.strokeDasharray = pathLength;
        pathElement.style.strokeDashoffset = pathLength;
        pathElement.style.transition = 'stroke-dashoffset 0.6s ease-out';
        stepTimeouts.push(setTimeout(() => pathElement.style.strokeDashoffset = '0', 10));

        for (let i = 0; i < 20; i++) {
          const particle = {
            element: document.createElementNS('http://www.w3.org/2000/svg', 'circle'),
            path: pathElement,
            startTime: performance.now() + i * 30,
            duration: 800 + Math.random() * 200,
            size: 1.5 + Math.random() * 2,
            offset: (Math.random() - 0.5) * 6,
            opacity: 0.4 + Math.random() * 0.6,
            speed: 0.8 + Math.random() * 0.4
          };
          particle.element.setAttribute('r', particle.size);
          particle.element.setAttribute('fill', particleColor);
          particle.element.setAttribute('filter', 'url(#particleGlow)');
          particlesContainer.appendChild(particle.element);
          particles.push(particle);
        }

        stepIndex++;
        stepTimeouts.push(setTimeout(processStep, step.delay || 500));
      }

      function animate() {
        if (currentScenario !== scenarioKey) return;
        
        const now = performance.now();
        particles.forEach((p, idx) => {
          const elapsed = now - p.startTime;
          if (elapsed < 0) { p.element.setAttribute('opacity', '0'); return; }
          
          const progress = Math.min((elapsed / p.duration) * p.speed, 1);
          const easedProgress = easeInOutCubic(progress);
          const point = getPointOnPath(p.path, easedProgress);
          
          const length = p.path.getTotalLength();
          const nextPoint = p.path.getPointAtLength(Math.min(length * easedProgress + 1, length));
          const angle = Math.atan2(nextPoint.y - point.y, nextPoint.x - point.x);
          const perpX = Math.cos(angle + Math.PI/2) * p.offset;
          const perpY = Math.sin(angle + Math.PI/2) * p.offset;
          
          p.element.setAttribute('cx', point.x + perpX);
          p.element.setAttribute('cy', point.y + perpY);
          
          let opacity = p.opacity;
          if (easedProgress < 0.15) opacity *= easedProgress / 0.15;
          else if (easedProgress > 0.85) opacity *= (1 - easedProgress) / 0.15;
          p.element.setAttribute('opacity', progress >= 1 ? 0 : opacity);
        });
        animationId = requestAnimationFrame(animate);
      }

      processStep();
      animate();
    }
  </script>
</body>
</html>
