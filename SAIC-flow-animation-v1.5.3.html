<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SAIC v1.5.3 Token Flow Animation ‚Äî Sovereign AI Cloud</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes glow {
      0%, 100% { filter: drop-shadow(0 0 3px currentColor); }
      50% { filter: drop-shadow(0 0 8px currentColor); }
    }
    .node-active { animation: glow 2.5s ease-in-out infinite; }
    .particle { position: absolute; border-radius: 50%; pointer-events: none; }
  </style>
</head>
<body class="bg-gray-900 min-h-screen p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-2xl font-bold text-white text-center mb-1">SAIC Framework v1.5.3 ‚Äî Token Flow Visualization</h1>
    <p class="text-gray-400 text-center text-sm mb-4">Sovereign AI Cloud | Dual-Tailnet Isolation | Family Tailnet ‚Üî Orchestrator ‚Üî AI Ops Tailnet</p>
    
    <!-- Scenario Selection -->
    <div class="flex flex-wrap gap-2 justify-center mb-4">
      <div class="text-xs text-gray-500 w-full text-center mb-1">TEXT INFERENCE (Mac Studio via AI Ops)</div>
      <button id="btn-small" onclick="selectScenario('small')" class="scenario-btn px-3 py-1.5 bg-green-700 hover:bg-green-600 text-white rounded text-xs font-medium transition-all" data-base="bg-green-700">7B Fast</button>
      <button id="btn-socratic" onclick="selectScenario('socratic')" class="scenario-btn px-3 py-1.5 bg-green-700 hover:bg-green-600 text-white rounded text-xs font-medium transition-all" data-base="bg-green-700">üìñ Socratic Math</button>
      <button id="btn-large" onclick="selectScenario('large')" class="scenario-btn px-3 py-1.5 bg-green-700 hover:bg-green-600 text-white rounded text-xs font-medium transition-all" data-base="bg-green-700">236B Deep</button>
      <button id="btn-batch" onclick="selectScenario('batch')" class="scenario-btn px-3 py-1.5 bg-green-700 hover:bg-green-600 text-white rounded text-xs font-medium transition-all" data-base="bg-green-700">üåô Nightly Batch</button>
      
      <div class="text-xs text-gray-500 w-full text-center mb-1 mt-2">VISUAL AI (RTX 4090 via AI Ops)</div>
      <button id="btn-image" onclick="selectScenario('image')" class="scenario-btn px-3 py-1.5 bg-lime-600 hover:bg-lime-500 text-white rounded text-xs font-medium transition-all" data-base="bg-lime-600">üñºÔ∏è Image Gen</button>
      <button id="btn-video" onclick="selectScenario('video')" class="scenario-btn px-3 py-1.5 bg-lime-600 hover:bg-lime-500 text-white rounded text-xs font-medium transition-all" data-base="bg-lime-600">üé¨ Video Gen</button>
      <button id="btn-audio" onclick="selectScenario('audio')" class="scenario-btn px-3 py-1.5 bg-lime-600 hover:bg-lime-500 text-white rounded text-xs font-medium transition-all" data-base="bg-lime-600">üéôÔ∏è Voice TTS</button>
      <button id="btn-transcode" onclick="selectScenario('transcode')" class="scenario-btn px-3 py-1.5 bg-lime-600 hover:bg-lime-500 text-white rounded text-xs font-medium transition-all" data-base="bg-lime-600">üìπ NVENC</button>
      
      <div class="text-xs text-gray-500 w-full text-center mb-1 mt-2">WORKFLOWS &amp; OTHER</div>
      <button id="btn-assistant" onclick="selectScenario('assistant')" class="scenario-btn px-3 py-1.5 bg-orange-600 hover:bg-orange-500 text-white rounded text-xs font-medium transition-all" data-base="bg-orange-600">ü§ñ OpenClaw</button>
      <button id="btn-portfolio" onclick="selectScenario('portfolio')" class="scenario-btn px-3 py-1.5 bg-pink-600 hover:bg-pink-500 text-white rounded text-xs font-medium transition-all" data-base="bg-pink-600">üìù Essay+Art</button>
      <button id="btn-overflow" onclick="selectScenario('overflow')" class="scenario-btn px-3 py-1.5 bg-purple-700 hover:bg-purple-600 text-white rounded text-xs font-medium transition-all" data-base="bg-purple-700">‚òÅÔ∏è Cloud 405B+</button>
    </div>

    <!-- SVG Diagram -->
    <div class="relative bg-gray-800 rounded-lg p-2 overflow-hidden">
      <svg id="architecture" viewBox="0 0 900 750" class="w-full h-auto">
        <defs>
          <filter id="glow"><feGaussianBlur stdDeviation="2" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          <filter id="particleGlow"><feGaussianBlur stdDeviation="1.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>

        <!-- Family Tailnet Region (Left) -->
        <rect x="30" y="40" width="260" height="420" rx="12" fill="#1c4532" opacity="0.15" stroke="#2d6a4f" stroke-width="2"/>
        <text x="160" y="65" text-anchor="middle" fill="#68d391" font-size="11" font-weight="bold">üè† FAMILY TAILNET</text>
        <text x="160" y="80" text-anchor="middle" fill="#68d391" font-size="8">(family.tailnet)</text>

        <!-- Orchestrator Region (Center) -->
        <rect x="320" y="40" width="180" height="420" rx="12" fill="#44337a" opacity="0.15" stroke="#6a1b9a" stroke-width="2"/>
        <text x="410" y="65" text-anchor="middle" fill="#d6bcfa" font-size="11" font-weight="bold">üåâ ORCHESTRATOR</text>
        <text x="410" y="80" text-anchor="middle" fill="#d6bcfa" font-size="8">(Bridge)</text>

        <!-- AI Ops Tailnet Region (Right) -->
        <rect x="530" y="40" width="340" height="420" rx="12" fill="#1a365d" opacity="0.15" stroke="#1565c0" stroke-width="2"/>
        <text x="700" y="65" text-anchor="middle" fill="#63b3ed" font-size="11" font-weight="bold">ü§ñ AI OPS TAILNET</text>
        <text x="700" y="80" text-anchor="middle" fill="#63b3ed" font-size="8">(ai-ops.tailnet)</text>

        <!-- Cloud Overflow Region -->
        <rect x="320" y="480" width="180" height="100" rx="8" fill="#44337a" opacity="0.2" stroke="#6a1b9a" stroke-width="1" stroke-dasharray="6,3"/>
        <text x="410" y="500" text-anchor="middle" fill="#b794f4" font-size="9" font-weight="bold">‚òÅÔ∏è CLOUD OVERFLOW (5%)</text>

        <!-- Static guide lines -->
        <g opacity="0.1" fill="none" stroke="#4a5568" stroke-width="1">
          <line x1="290" y1="160" x2="320" y2="160"/>
          <line x1="500" y1="160" x2="530" y2="160"/>
          <line x1="410" y1="280" x2="410" y2="480"/>
        </g>

        <!-- ==================== FAMILY TAILNET NODES ==================== -->
        
        <!-- Client Device -->
        <g id="node-client" class="node" data-x="160" data-y="130">
          <rect x="60" y="100" width="200" height="50" rx="8" fill="#2d3748" stroke="#16697a" stroke-width="2"/>
          <text x="160" y="122" text-anchor="middle" fill="white" font-size="11" font-weight="bold">üë§ Client Device</text>
          <text x="160" y="138" text-anchor="middle" fill="#b2ebf2" font-size="9">iPad / Laptop / Phone</text>
        </g>

        <!-- OpenClaw on Family Tailnet -->
        <g id="node-openClaw" class="node" data-x="160" data-y="210">
          <rect x="60" y="175" width="200" height="65" rx="8" fill="#2d3748" stroke="#ff6f00" stroke-width="2"/>
          <text x="160" y="197" text-anchor="middle" fill="white" font-size="10" font-weight="bold">ü§ñ OpenClaw (RPi5 #1)</text>
          <text x="160" y="213" text-anchor="middle" fill="#fbd38d" font-size="8">16GB | Isolated 24/7</text>
          <text x="160" y="228" text-anchor="middle" fill="#f6ad55" font-size="8">qwen2.5:7b | Email/Calendar :3000</text>
        </g>

        <!-- NAS Storage -->
        <g id="node-nas" class="node" data-x="160" data-y="310">
          <rect x="60" y="265" width="200" height="85" rx="8" fill="#2d3748" stroke="#ec4899" stroke-width="2"/>
          <text x="160" y="287" text-anchor="middle" fill="white" font-size="10" font-weight="bold">üíæ Synology NAS DS423</text>
          <text x="160" y="303" text-anchor="middle" fill="#f9a8d4" font-size="8">24TB SHR | 3-2-1 Backup</text>
          <text x="160" y="318" text-anchor="middle" fill="#f687b3" font-size="7">/family /portfolios /journals /learning</text>
          <text x="160" y="332" text-anchor="middle" fill="#f687b3" font-size="7">/generated /obsidian</text>
          <text x="160" y="345" text-anchor="middle" fill="#a0aec0" font-size="7">SMB for users | NFS bridge to AI Ops</text>
        </g>

        <!-- ==================== ORCHESTRATOR (MAC MINI) ==================== -->
        
        <g id="node-router" class="node" data-x="410" data-y="160">
          <rect x="335" y="100" width="150" height="120" rx="8" fill="#2d3748" stroke="#6a1b9a" stroke-width="2"/>
          <text x="410" y="120" text-anchor="middle" fill="white" font-size="10" font-weight="bold">üçé Mac mini M4 Pro</text>
          <text x="410" y="135" text-anchor="middle" fill="#d6bcfa" font-size="8">48GB | Dual Network</text>
          <rect x="345" y="145" width="130" height="30" rx="4" fill="#40916c" stroke="#1b4332" stroke-width="1"/>
          <text x="410" y="158" text-anchor="middle" fill="white" font-size="8" font-weight="bold">üéØ Intelligent Router</text>
          <text x="410" y="170" text-anchor="middle" fill="#c6f6d5" font-size="7">Text‚ÜíStudio | Visual‚Üí4090</text>
          <text x="370" y="190" text-anchor="middle" fill="#d6bcfa" font-size="7">LangFlow</text>
          <text x="410" y="190" text-anchor="middle" fill="#d6bcfa" font-size="7">n8n</text>
          <text x="450" y="190" text-anchor="middle" fill="#d6bcfa" font-size="7">Grafana</text>
          <text x="410" y="205" text-anchor="middle" fill="#a0aec0" font-size="7">AnythingLLM :3001 | Traefik</text>
        </g>

        <!-- PII Filter -->
        <g id="node-piiFilter" class="node" data-x="410" data-y="280">
          <rect x="345" y="250" width="130" height="45" rx="6" fill="#2d3748" stroke="#ed1c24" stroke-width="1.5"/>
          <text x="410" y="270" text-anchor="middle" fill="white" font-size="9" font-weight="bold">üõ°Ô∏è Nemotron PII Filter</text>
          <text x="410" y="285" text-anchor="middle" fill="#fc8181" font-size="7">Cloud Requests Only</text>
        </g>

        <!-- Learning Features -->
        <g id="node-features">
          <rect x="340" y="310" width="140" height="40" rx="6" fill="#d4edda" stroke="#2d6a4f" stroke-width="1"/>
          <text x="410" y="328" text-anchor="middle" fill="#1a1a2e" font-size="7" font-weight="bold">üìö Learning Features</text>
          <text x="410" y="342" text-anchor="middle" fill="#2d6a4f" font-size="6">Socratic | Explain-3-Ways | PBL</text>
        </g>

        <!-- ==================== AI OPS TAILNET NODES ==================== -->

        <!-- Mac Studio -->
        <g id="node-macStudio" class="node" data-x="700" data-y="130">
          <rect x="545" y="95" width="310" height="75" rx="8" fill="#2d3748" stroke="#1565c0" stroke-width="2"/>
          <text x="700" y="115" text-anchor="middle" fill="white" font-size="11" font-weight="bold">üçé Mac Studio M3 Ultra ‚Äî TEXT LLMs</text>
          <text x="700" y="132" text-anchor="middle" fill="#90cdf4" font-size="8">256GB Unified | 4TB | Ollama :11434 | ~150W</text>
          <text x="700" y="147" text-anchor="middle" fill="#63b3ed" font-size="7">70B: 6-7 tok/s | 236B: 2-3 tok/s | Socratic | RAG</text>
          <text x="700" y="162" text-anchor="middle" fill="#a0aec0" font-size="7">Llama 3.2 70B | Qwen 2.5 72B | DeepSeek v3 236B</text>
        </g>

        <!-- RTX 4090 -->
        <g id="node-rtx4090" class="node" data-x="700" data-y="220">
          <rect x="545" y="185" width="310" height="75" rx="8" fill="#2d3748" stroke="#76b900" stroke-width="3"/>
          <text x="700" y="205" text-anchor="middle" fill="white" font-size="11" font-weight="bold">üé® RTX 4090 ‚Äî VISUAL AI HUB</text>
          <text x="700" y="222" text-anchor="middle" fill="#9ae6b4" font-size="8">24GB VRAM | 16K CUDA | 64GB DDR5 | ~600W</text>
          <text x="610" y="238" text-anchor="middle" fill="#68d391" font-size="7">ComfyUI :8188</text>
          <text x="670" y="238" text-anchor="middle" fill="#68d391" font-size="7">Video :7860</text>
          <text x="730" y="238" text-anchor="middle" fill="#68d391" font-size="7">Coqui :5002</text>
          <text x="790" y="238" text-anchor="middle" fill="#68d391" font-size="7">NVENC :9000</text>
          <text x="700" y="252" text-anchor="middle" fill="#a0aec0" font-size="7">Image 8-12s | Video 60-90s | Voice Real-time</text>
        </g>

        <!-- AI Max+ Knowledge -->
        <g id="node-knowledge" class="node" data-x="700" data-y="310">
          <rect x="545" y="275" width="310" height="60" rx="8" fill="#2d3748" stroke="#9c27b0" stroke-width="2"/>
          <text x="700" y="295" text-anchor="middle" fill="white" font-size="10" font-weight="bold">üß† AI Max+ 395 ‚Äî KNOWLEDGE LAYER</text>
          <text x="700" y="312" text-anchor="middle" fill="#d6bcfa" font-size="8">128GB | Qdrant :6333 | Redis | Nemotron Safety</text>
          <text x="700" y="327" text-anchor="middle" fill="#a0aec0" font-size="7">user_progress | obsidian_vault | learning_content | journals</text>
        </g>

        <!-- Support Nodes -->
        <g id="node-support">
          <rect x="545" y="350" width="310" height="50" rx="6" fill="#2d3748" stroke="#607d8b" stroke-width="1" stroke-dasharray="4,2"/>
          <text x="700" y="368" text-anchor="middle" fill="#a0aec0" font-size="9" font-weight="bold">Support: DGX Spark √ó2 (Batch) | K6 (JupyterLab) | M7 √ó2 (CI/Jekyll)</text>
          <text x="700" y="385" text-anchor="middle" fill="#718096" font-size="7">High-speed internal clustering | No direct user access</text>
        </g>

        <!-- ==================== CLOUD OVERFLOW ==================== -->
        
        <g id="node-cloudGateway" class="node" data-x="410" data-y="530">
          <rect x="340" y="510" width="140" height="55" rx="6" fill="#553c9a" stroke="#6a1b9a" stroke-width="1.5"/>
          <text x="410" y="530" text-anchor="middle" fill="white" font-size="9" font-weight="bold">‚òÅÔ∏è Cloud Gateway</text>
          <text x="410" y="545" text-anchor="middle" fill="#d6bcfa" font-size="7">NVIDIA Brev | Gemini | Claude</text>
          <text x="410" y="558" text-anchor="middle" fill="#fc8181" font-size="7">Adult-Only by Default</text>
        </g>

        <!-- Response -->
        <g id="node-response" class="node" data-x="160" data-y="420">
          <rect x="60" y="395" width="200" height="45" rx="8" fill="#2d3748" stroke="#2d6a4f" stroke-width="2"/>
          <text x="160" y="415" text-anchor="middle" fill="white" font-size="11" font-weight="bold">‚úÖ Response</text>
          <text x="160" y="430" text-anchor="middle" fill="#68d391" font-size="9">To Client via Orchestrator</text>
        </g>

        <!-- ==================== DATA FLOW PATHS ==================== -->
        
        <!-- Animated paths container -->
        <g id="paths"></g>
        <!-- Particles container -->
        <g id="particles"></g>

        <!-- Legend -->
        <g transform="translate(30, 610)">
          <text fill="#a0aec0" font-size="10" font-weight="bold">FLOW KEY:</text>
          <rect x="80" y="-10" width="80" height="16" rx="3" fill="#1c4532" opacity="0.5" stroke="#2d6a4f"/>
          <text x="120" y="2" text-anchor="middle" fill="#68d391" font-size="8">Family Tailnet</text>
          <rect x="170" y="-10" width="70" height="16" rx="3" fill="#44337a" opacity="0.5" stroke="#6a1b9a"/>
          <text x="205" y="2" text-anchor="middle" fill="#d6bcfa" font-size="8">Orchestrator</text>
          <rect x="250" y="-10" width="70" height="16" rx="3" fill="#1a365d" opacity="0.5" stroke="#1565c0"/>
          <text x="285" y="2" text-anchor="middle" fill="#63b3ed" font-size="8">AI Ops</text>
          <circle cx="345" cy="-2" r="4" fill="#48bb78"/>
          <text x="365" y="2" fill="#a0aec0" font-size="8">Text</text>
          <circle cx="400" cy="-2" r="4" fill="#9ae6b4"/>
          <text x="420" y="2" fill="#a0aec0" font-size="8">Visual</text>
          <circle cx="455" cy="-2" r="4" fill="#f6ad55"/>
          <text x="485" y="2" fill="#a0aec0" font-size="8">Assistant</text>
          <circle cx="525" cy="-2" r="4" fill="#b794f4"/>
          <text x="550" y="2" fill="#a0aec0" font-size="8">Cloud</text>
        </g>
      </svg>

      <!-- Info Panel -->
      <div id="infoPanel" class="absolute top-2 right-2 bg-gray-900/90 rounded-lg p-3 text-white text-sm max-w-xs">
        <div id="scenarioName" class="font-bold text-green-400 mb-1">Select a scenario</div>
        <div id="scenarioDesc" class="text-gray-300 text-xs mb-2">Click a button to visualize token flow through dual-Tailnet architecture</div>
        <div id="metrics" class="text-xs space-y-1 hidden">
          <div>Speed: <span id="metricSpeed" class="text-green-400">-</span></div>
          <div>Latency: <span id="metricLatency" class="text-yellow-400">-</span></div>
          <div>Path: <span id="metricDest" class="text-blue-400">-</span></div>
        </div>
      </div>
    </div>

    <!-- Architecture Summary -->
    <div class="mt-4 grid grid-cols-2 md:grid-cols-5 gap-2 text-xs">
      <div class="bg-green-900/50 rounded-lg p-2 border border-green-700/30">
        <div class="text-green-300 font-bold">Family Tailnet</div>
        <div class="text-gray-400">Devices + NAS + OpenClaw</div>
      </div>
      <div class="bg-purple-900/50 rounded-lg p-2 border border-purple-700/30">
        <div class="text-purple-300 font-bold">Orchestrator</div>
        <div class="text-gray-400">Mac mini | Bridges Both</div>
      </div>
      <div class="bg-blue-900/50 rounded-lg p-2 border border-blue-700/30">
        <div class="text-blue-300 font-bold">AI Ops Tailnet</div>
        <div class="text-gray-400">Studio + 4090 + AI Max+</div>
      </div>
      <div class="bg-lime-900/50 rounded-lg p-2 border border-lime-700/30">
        <div class="text-lime-300 font-bold">Visual AI Hub</div>
        <div class="text-gray-400">RTX 4090 | 24GB VRAM</div>
      </div>
      <div class="bg-gray-700/50 rounded-lg p-2 border border-gray-600/30">
        <div class="text-gray-300 font-bold">Total Power</div>
        <div class="text-gray-400">~1,000W Full Stack</div>
      </div>
    </div>
  </div>

  <script>
    const flowPaths = {
      'client-router': { type: 'line', points: [[160, 150], [335, 160]] },
      'router-macStudio': { type: 'curve', points: [[485, 140], [515, 130], [545, 130]] },
      'router-rtx4090': { type: 'curve', points: [[485, 160], [515, 200], [545, 220]] },
      'router-knowledge': { type: 'curve', points: [[485, 180], [520, 280], [545, 300]] },
      'router-piiFilter': { type: 'line', points: [[410, 220], [410, 250]] },
      'macStudio-knowledge': { type: 'line', points: [[700, 170], [700, 275]] },
      'rtx4090-knowledge': { type: 'line', points: [[700, 260], [700, 275]] },
      'knowledge-macStudio': { type: 'curve', points: [[620, 275], [600, 200], [620, 170]] },
      'piiFilter-cloudGateway': { type: 'line', points: [[410, 295], [410, 510]] },
      'cloudGateway-response': { type: 'curve', points: [[340, 540], [250, 500], [160, 440]] },
      'macStudio-response': { type: 'curve', points: [[545, 150], [400, 300], [260, 420]] },
      'rtx4090-response': { type: 'curve', points: [[545, 230], [400, 350], [260, 420]] },
      'client-openClaw': { type: 'line', points: [[160, 150], [160, 175]] },
      'openClaw-response': { type: 'line', points: [[160, 240], [160, 395]] },
      'openClaw-nas': { type: 'line', points: [[160, 240], [160, 265]] },
      'macStudio-nas': { type: 'curve', points: [[545, 150], [300, 250], [260, 310]] },
      'rtx4090-nas': { type: 'curve', points: [[545, 230], [300, 290], [260, 310]] },
      'knowledge-nas': { type: 'curve', points: [[545, 310], [350, 330], [260, 310]] },
      'router-response': { type: 'curve', points: [[335, 200], [280, 350], [260, 395]] },
    };

    const scenarios = {
      small: {
        name: '7B Model ‚Äî Fast Text',
        description: 'Family Tailnet ‚Üí Orchestrator ‚Üí AI Ops (Mac Studio) ‚Üí Response',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-macStudio', delay: 600 },
          { path: 'macStudio-knowledge', delay: 400 },
          { path: 'knowledge-macStudio', delay: 400 },
          { path: 'macStudio-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'macStudio', 'knowledge', 'response'],
        metrics: { speed: '50+ tok/s', latency: '15ms', dest: 'Family ‚Üí Orch ‚Üí AI Ops ‚Üí Response' },
        isCloud: false,
        particleColor: '#48bb78'
      },
      socratic: {
        name: 'üìñ Workflow 1: Socratic Math Session',
        description: 'Child connects ‚Üí AnythingLLM ‚Üí LangFlow Socratic ‚Üí Mac Studio ‚Üí mastery from Qdrant',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-macStudio', delay: 600 },
          { path: 'macStudio-nas', delay: 400 },
          { path: 'macStudio-knowledge', delay: 400 },
          { path: 'knowledge-macStudio', delay: 400 },
          { path: 'macStudio-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'macStudio', 'nas', 'knowledge', 'response'],
        metrics: { speed: '6-7 tok/s', latency: '45ms', dest: 'Family ‚Üí Orch ‚Üí AI Ops (Socratic)' },
        isCloud: false,
        particleColor: '#48bb78'
      },
      large: {
        name: '236B Model ‚Äî Deep Reasoning',
        description: 'DeepSeek v3 236B for complex analysis via dual-Tailnet path',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-macStudio', delay: 600 },
          { path: 'macStudio-nas', delay: 500 },
          { path: 'macStudio-knowledge', delay: 400 },
          { path: 'knowledge-macStudio', delay: 400 },
          { path: 'macStudio-response', delay: 700 }
        ],
        nodes: ['client', 'router', 'macStudio', 'nas', 'knowledge', 'response'],
        metrics: { speed: '2-3 tok/s', latency: '200ms', dest: 'Family ‚Üí Orch ‚Üí AI Ops (Deep)' },
        isCloud: false,
        particleColor: '#48bb78'
      },
      batch: {
        name: 'üåô Workflow 3: Nightly Learning Automation',
        description: '2 AM n8n trigger ‚Üí Mac Studio + RTX 4090 ‚Üí Email report to parents',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-macStudio', delay: 600 },
          { path: 'macStudio-knowledge', delay: 400 },
          { path: 'router-rtx4090', delay: 500 },
          { path: 'rtx4090-nas', delay: 400 },
          { path: 'macStudio-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'macStudio', 'knowledge', 'rtx4090', 'nas', 'response'],
        metrics: { speed: 'Batch', latency: 'Scheduled', dest: 'Orch ‚Üí AI Ops (Text+Visual)' },
        isCloud: false,
        particleColor: '#48bb78'
      },
      image: {
        name: 'üñºÔ∏è Image Generation ‚Äî ComfyUI',
        description: 'Routed through Orchestrator to RTX 4090 on AI Ops Tailnet',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-rtx4090', delay: 600 },
          { path: 'rtx4090-nas', delay: 400 },
          { path: 'rtx4090-response', delay: 700 }
        ],
        nodes: ['client', 'router', 'rtx4090', 'nas', 'response'],
        metrics: { speed: '8-12 sec/img', latency: '100ms', dest: 'Family ‚Üí Orch ‚Üí AI Ops (4090)' },
        isCloud: false,
        particleColor: '#9ae6b4'
      },
      video: {
        name: 'üé¨ Video Generation ‚Äî Stable Video',
        description: 'Animated explainers via AI Ops Tailnet RTX 4090',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-rtx4090', delay: 600 },
          { path: 'rtx4090-nas', delay: 500 },
          { path: 'rtx4090-response', delay: 800 }
        ],
        nodes: ['client', 'router', 'rtx4090', 'nas', 'response'],
        metrics: { speed: '60-90 sec/vid', latency: '150ms', dest: 'Family ‚Üí Orch ‚Üí AI Ops (Video)' },
        isCloud: false,
        particleColor: '#9ae6b4'
      },
      audio: {
        name: 'üéôÔ∏è Voice Synthesis ‚Äî Coqui TTS',
        description: 'TTS narration via AI Ops Tailnet',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-rtx4090', delay: 600 },
          { path: 'rtx4090-nas', delay: 300 },
          { path: 'rtx4090-response', delay: 500 }
        ],
        nodes: ['client', 'router', 'rtx4090', 'nas', 'response'],
        metrics: { speed: 'Real-time', latency: '50ms', dest: 'Family ‚Üí Orch ‚Üí AI Ops (TTS)' },
        isCloud: false,
        particleColor: '#9ae6b4'
      },
      transcode: {
        name: 'üìπ Video Transcode ‚Äî NVENC',
        description: 'H.265 encoding via RTX 4090 NVENC on AI Ops',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-rtx4090', delay: 600 },
          { path: 'rtx4090-nas', delay: 400 },
          { path: 'rtx4090-response', delay: 500 }
        ],
        nodes: ['client', 'router', 'rtx4090', 'nas', 'response'],
        metrics: { speed: 'Real-time+', latency: '30ms', dest: 'Family ‚Üí Orch ‚Üí AI Ops (NVENC)' },
        isCloud: false,
        particleColor: '#9ae6b4'
      },
      assistant: {
        name: 'ü§ñ OpenClaw ‚Äî Personal Assistant',
        description: 'Isolated on Family Tailnet (no AI Ops access) ‚Äî direct response',
        steps: [
          { path: 'client-openClaw', delay: 0 },
          { path: 'openClaw-nas', delay: 400 },
          { path: 'openClaw-response', delay: 500 }
        ],
        nodes: ['client', 'openClaw', 'nas', 'response'],
        metrics: { speed: '15 tok/s', latency: '30ms', dest: 'Family Tailnet Only (Isolated)' },
        isCloud: false,
        particleColor: '#f6ad55'
      },
      portfolio: {
        name: 'üìù Workflow 2: Essay + Cover Art + Portfolio',
        description: 'Mac Studio editing ‚Üí ComfyUI cover art ‚Üí Jekyll build on M7',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-macStudio', delay: 600 },
          { path: 'macStudio-knowledge', delay: 400 },
          { path: 'macStudio-nas', delay: 400 },
          { path: 'router-rtx4090', delay: 500 },
          { path: 'rtx4090-nas', delay: 400 },
          { path: 'rtx4090-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'macStudio', 'knowledge', 'rtx4090', 'nas', 'response'],
        metrics: { speed: 'Multi-step', latency: '~20s total', dest: 'AI Ops (Text+Visual) ‚Üí M7' },
        isCloud: false,
        particleColor: '#f687b3'
      },
      overflow: {
        name: '‚òÅÔ∏è 405B+ Model ‚Äî Cloud Overflow',
        description: 'Exceeds local ‚Üí PII filter ‚Üí Cloud Gateway (Adult-only)',
        steps: [
          { path: 'client-router', delay: 0 },
          { path: 'router-piiFilter', delay: 600 },
          { path: 'piiFilter-cloudGateway', delay: 700 },
          { path: 'cloudGateway-response', delay: 600 }
        ],
        nodes: ['client', 'router', 'piiFilter', 'cloudGateway', 'response'],
        metrics: { speed: '40 tok/s', latency: '300ms', dest: 'Orch ‚Üí PII Filter ‚Üí Cloud' },
        isCloud: true,
        particleColor: '#b794f4'
      }
    };

    let animationId = null;
    let particles = [];
    let currentScenario = null;
    let loopTimeoutId = null;
    let stepTimeouts = [];

    function selectScenario(scenarioKey) {
      if (currentScenario === scenarioKey) {
        stopScenario();
        return;
      }
      
      if (currentScenario !== null) {
        clearAnimation();
      }
      
      document.querySelectorAll('.scenario-btn').forEach(btn => {
        btn.classList.remove('ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-gray-900', 
                             'bg-green-500', 'bg-lime-400', 'bg-orange-400', 'bg-purple-500', 'bg-pink-400');
        const baseClass = btn.dataset.base;
        if (baseClass) btn.classList.add(baseClass);
      });
      
      const activeBtn = document.getElementById(`btn-${scenarioKey}`);
      if (activeBtn) {
        const baseClass = activeBtn.dataset.base;
        if (baseClass) activeBtn.classList.remove(baseClass);
        activeBtn.classList.add('ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-gray-900');
        if (baseClass === 'bg-green-700') activeBtn.classList.add('bg-green-500');
        else if (baseClass === 'bg-lime-600') activeBtn.classList.add('bg-lime-400');
        else if (baseClass === 'bg-orange-600') activeBtn.classList.add('bg-orange-400');
        else if (baseClass === 'bg-purple-700') activeBtn.classList.add('bg-purple-500');
        else if (baseClass === 'bg-pink-600') activeBtn.classList.add('bg-pink-400');
      }
      
      currentScenario = scenarioKey;
      runScenario(scenarioKey);
    }

    function stopScenario() {
      clearAnimation();
      currentScenario = null;
      
      document.querySelectorAll('.scenario-btn').forEach(btn => {
        btn.classList.remove('ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-gray-900',
                             'bg-green-500', 'bg-lime-400', 'bg-orange-400', 'bg-purple-500', 'bg-pink-400');
        const baseClass = btn.dataset.base;
        if (baseClass) btn.classList.add(baseClass);
      });
      
      document.getElementById('scenarioName').textContent = 'Select a scenario';
      document.getElementById('scenarioDesc').textContent = 'Click a button to visualize token flow through dual-Tailnet architecture';
      document.getElementById('metrics').classList.add('hidden');
    }

    function getPathString(pathDef) {
      const { type, points } = pathDef;
      if (type === 'line') {
        return `M ${points[0][0]} ${points[0][1]} L ${points[1][0]} ${points[1][1]}`;
      } else {
        return `M ${points[0][0]} ${points[0][1]} Q ${points[1][0]} ${points[1][1]} ${points[2][0]} ${points[2][1]}`;
      }
    }

    function getPointOnPath(pathElement, progress) {
      const length = pathElement.getTotalLength();
      const point = pathElement.getPointAtLength(length * progress);
      return { x: point.x, y: point.y };
    }

    function easeInOutCubic(t) {
      return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
    }

    function clearAnimation() {
      if (animationId) cancelAnimationFrame(animationId);
      if (loopTimeoutId) clearTimeout(loopTimeoutId);
      stepTimeouts.forEach(t => clearTimeout(t));
      animationId = null;
      loopTimeoutId = null;
      stepTimeouts = [];
      particles = [];
      document.getElementById('paths').innerHTML = '';
      document.getElementById('particles').innerHTML = '';
      document.querySelectorAll('.node-active').forEach(el => el.classList.remove('node-active'));
    }

    function runScenario(scenarioKey) {
      if (currentScenario !== scenarioKey) return;
      
      clearAnimation();
      const scenario = scenarios[scenarioKey];
      
      document.getElementById('scenarioName').textContent = scenario.name;
      document.getElementById('scenarioDesc').textContent = scenario.description;
      document.getElementById('metrics').classList.remove('hidden');
      document.getElementById('metricSpeed').textContent = scenario.metrics.speed;
      document.getElementById('metricLatency').textContent = scenario.metrics.latency;
      document.getElementById('metricDest').textContent = scenario.metrics.dest;

      scenario.nodes.forEach(nodeId => {
        const node = document.getElementById(`node-${nodeId}`);
        if (node) node.classList.add('node-active');
      });

      const pathsContainer = document.getElementById('paths');
      const particlesContainer = document.getElementById('particles');
      const particleColor = scenario.particleColor || (scenario.isCloud ? '#b794f4' : '#48bb78');
      
      let stepIndex = 0;

      function processStep() {
        if (currentScenario !== scenarioKey) return;
        
        if (stepIndex >= scenario.steps.length) {
          loopTimeoutId = setTimeout(() => {
            if (currentScenario === scenarioKey) {
              runScenario(scenarioKey);
            }
          }, 2000);
          return;
        }

        const step = scenario.steps[stepIndex];
        const pathDef = flowPaths[step.path];
        if (!pathDef) { stepIndex++; processStep(); return; }

        const pathString = getPathString(pathDef);
        const pathElement = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        pathElement.setAttribute('d', pathString);
        pathElement.setAttribute('fill', 'none');
        pathElement.setAttribute('stroke', particleColor);
        pathElement.setAttribute('stroke-width', scenario.isCloud ? '2' : '3');
        pathElement.setAttribute('opacity', '0.6');
        if (scenario.isCloud) pathElement.setAttribute('stroke-dasharray', '8,4');
        pathsContainer.appendChild(pathElement);

        const pathLength = pathElement.getTotalLength();
        pathElement.style.strokeDasharray = pathLength;
        pathElement.style.strokeDashoffset = pathLength;
        pathElement.style.transition = 'stroke-dashoffset 0.6s ease-out';
        stepTimeouts.push(setTimeout(() => pathElement.style.strokeDashoffset = '0', 10));

        for (let i = 0; i < 20; i++) {
          const particle = {
            element: document.createElementNS('http://www.w3.org/2000/svg', 'circle'),
            path: pathElement,
            startTime: performance.now() + i * 30,
            duration: 800 + Math.random() * 200,
            size: 1.5 + Math.random() * 2,
            offset: (Math.random() - 0.5) * 6,
            opacity: 0.4 + Math.random() * 0.6,
            speed: 0.8 + Math.random() * 0.4
          };
          particle.element.setAttribute('r', particle.size);
          particle.element.setAttribute('fill', particleColor);
          particle.element.setAttribute('filter', 'url(#particleGlow)');
          particlesContainer.appendChild(particle.element);
          particles.push(particle);
        }

        stepIndex++;
        stepTimeouts.push(setTimeout(processStep, step.delay || 500));
      }

      function animate() {
        if (currentScenario !== scenarioKey) return;
        
        const now = performance.now();
        particles.forEach((p, idx) => {
          const elapsed = now - p.startTime;
          if (elapsed < 0) { p.element.setAttribute('opacity', '0'); return; }
          
          const progress = Math.min((elapsed / p.duration) * p.speed, 1);
          const easedProgress = easeInOutCubic(progress);
          const point = getPointOnPath(p.path, easedProgress);
          
          const length = p.path.getTotalLength();
          const nextPoint = p.path.getPointAtLength(Math.min(length * easedProgress + 1, length));
          const angle = Math.atan2(nextPoint.y - point.y, nextPoint.x - point.x);
          const perpX = Math.cos(angle + Math.PI/2) * p.offset;
          const perpY = Math.sin(angle + Math.PI/2) * p.offset;
          
          p.element.setAttribute('cx', point.x + perpX);
          p.element.setAttribute('cy', point.y + perpY);
          
          let opacity = p.opacity;
          if (easedProgress < 0.15) opacity *= easedProgress / 0.15;
          else if (easedProgress > 0.85) opacity *= (1 - easedProgress) / 0.15;
          p.element.setAttribute('opacity', progress >= 1 ? 0 : opacity);
        });
        animationId = requestAnimationFrame(animate);
      }

      processStep();
      animate();
    }
  </script>
</body>
</html>
